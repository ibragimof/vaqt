function onLocationFound(t){let n=t.accuracy,e=L.marker(t.latlng,{icon:logoIcon}).addTo(currentMap).bindPopup("<b>Харитадаги ўрнингиз</b><br>(Аниқлик &asymp; "+Math.floor(n)+" метргача)").openPopup();L.circle(t.latlng,n).addTo(currentMap),userCoordinates=t.latlng,globalScope(),pathToQibla.push(e.getLatLng()),route=polygone(pathToQibla,{color:"red"}).addTo(currentMap),from=qibla.getLatLng(),to=e.getLatLng(),distance=Math.trunc(from.distanceTo(to)/1e3),document.getElementById("distance").innerHTML=distance}function onLocationError(t){alert(`Хатолик юз берди. Биз сиз турган жойни аниқлай олмадик. Намоз вақтларини билиш учун харитадан ўзингизга керакли жойни белгиланг.\r\n\n ${t.message}`)}function clickEvent(t){"undefined"==typeof newMarker?(newMarker=new L.marker(t.latlng),newMarker.addTo(currentMap).bindPopup("<b>Жой танланди</b><br>"+t.latlng.toString().slice(6)).openPopup()):newMarker.setLatLng(t.latlng).bindPopup("<b>Жой танланди</b><br>"+t.latlng.toString().slice(6)).openPopup(),pathToQibla[1]=newMarker.getLatLng(),route?(currentMap.removeLayer(route),route=polygone(pathToQibla,{color:"red"}).addTo(currentMap),from=qibla.getLatLng(),to=newMarker.getLatLng(),distance=Math.trunc(from.distanceTo(to)/1e3),document.getElementById("distance").innerHTML=distance):(route=polygone(pathToQibla,{color:"red"}).addTo(currentMap),from=qibla.getLatLng(),to=newMarker.getLatLng(),distance=Math.trunc(from.distanceTo(to)/1e3),document.getElementById("distance").innerHTML=distance),userCoordinates=t.latlng,globalScope()}(function(){function t(t,n,e){var r=t.lng*o,s=n.lng*o,l=r-s,c=Math.floor(Math.abs(l*i/this.options.segmentsCoeff));if(!(c<2))for(var g=t.lat*o,u=n.lat*o,h=Math.sin(g),d=Math.sin(u),p=Math.cos(g),f=Math.cos(u),M=h*f,b=d*p,m=p*f*Math.sin(l),y=1;y<c;y++){var _=r-l*(y/c),P=Math.atan((M*Math.sin(_-s)-b*Math.sin(_-r))/m);e.push(L.latLng(P*a,_*a))}}function n(t,n){var e=[],o=this instanceof L.Polygon;o?t.push(t[0]):e.push(t[0]);for(var a=0,i=t.length-1;a<i;a++)n.call(this,t[a],t[a+1],e),e.push(t[a+1]);return e}function e(t){if(0===t.length)return[];var n=t[0].lng;t=t.map(function(t){return L.latLng(t.lat,t.lng-n).wrap()});var e=this._processPoly(t,this._geodesicConvertLine);return e=e.map(function(t){return L.latLng(t.lat,t.lng+n)}),e}var o=Math.PI/180,a=180/Math.PI,i=6367e3,r={segmentsCoeff:5e3},s={_geodesicConvertLine:t,_processPoly:n,_geodesicConvertLines:e,_geodesicConvert:function(){this._latlngs=this._geodesicConvertLines(this._latlngsinit),this._convertLatLngs(this._latlngs)},options:r,initialize:function(t,n){L.Polyline.prototype.initialize.call(this,t,n),this._geodesicConvert()},getLatLngs:function(){return this._latlngsinit},_setLatLngs:function(t){this._bounds=L.latLngBounds(),this._latlngsinit=this._convertLatLngs(t)},_defaultShape:function(){var t=this._latlngsinit;return L.LineUtil.isFlat(t)?t:t[0]},redraw:function(){return this._geodesicConvert(),L.Path.prototype.redraw.call(this)}};L.GeodesicPolyline=L.Polyline.extend(s),s.options=r,L.GeodesicPolygon=L.Polygon.extend(s),L.GeodesicCircle=L.Polygon.extend({options:{segmentsCoeff:1e3,segmentsMin:48},initialize:function(t,n,e){"number"==typeof n&&(n=L.extend({},e,{radius:n})),this._latlng=L.latLng(t),this._radius=n.radius;var o=this._calcPoints();L.Polygon.prototype.initialize.call(this,o,n)},setLatLng:function(t){this._latlng=L.latLng(t);var n=this._calcPoints();this.setLatLngs(n)},setRadius:function(t){this._radius=t;var n=this._calcPoints();this.setLatLngs(n)},getLatLng:function(){return this._latlng},getRadius:function(){return this._radius},_calcPoints:function(){for(var t=this._radius/i,n=this._latlng.lat*o,e=this._latlng.lng*o,r=Math.cos(n),s=Math.sin(n),l=Math.cos(t),c=Math.sin(t),g=function(t){var n=Math.asin(s*l+r*c*Math.cos(t)),o=e+Math.atan2(Math.sin(t)*c*r,l-s*Math.sin(n));return L.latLng(n*a,o*a)},u=this.options,h=Math.max(u.segmentsMin,Math.floor(this._radius/u.segmentsCoeff)),d=[],p=0;p<h;p++){var f=2*Math.PI/h*p,M=g(f);d.push(M)}return d}}),L.geodesicPolyline=function(t,n){return new L.GeodesicPolyline(t,n)},L.geodesicPolygon=function(t,n){return new L.GeodesicPolygon(t,n)},L.geodesicCircle=function(t,n,e){return new L.GeodesicCircle(t,n,e)}})();let currentMap=L.map("map").setView([39.65,66.95],4);L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{minZoom:2,maxZoom:20}).addTo(currentMap),currentMap.locate({setView:!0});let route,from,to,distance,logoIcon=L.icon({iconUrl:"/assets/logo.png",iconAnchor:[15,40],popupAnchor:[0,-43]}),kaabahIcon=L.icon({iconUrl:"/assets/kaaba.png",iconAnchor:[5,35],popupAnchor:[18,-43]}),markerCoordinates=Array(),userCoordinates=new Object,pathToQibla=new Array,polygone=L.geodesicPolyline,qibla=L.marker([21.422505,39.826216],{icon:kaabahIcon});qibla.addTo(currentMap).bindPopup("<b>Каъба, Макка шаҳри</b><br>(Қибла)").openPopup(),pathToQibla.push(qibla.getLatLng()),currentMap.on("locationfound",onLocationFound),currentMap.on("locationerror",onLocationError),currentMap.on("click",clickEvent);